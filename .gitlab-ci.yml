image: node:12-alpine

before_script:
  - apk update && apk upgrade && apk add --no-cache bash git openssh
  - eval $(ssh-agent -s)
  - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
  - mkdir -p ~/.ssh
  - chmod 700 ~/.ssh
  - ssh-keyscan gitlab.beautybox.ru >> ~/.ssh/known_hosts
  - chmod 644 ~/.ssh/known_hosts
  #- '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config'
  # - ssh gitlab.beautybox.ru
  - git config --global user.email "webmaster@beautybox.ru"
  - git config --global user.name "Webmaster Admin"

Test SSH:
  tags: [build]
  script:
    - ssh gitlab.beautybox.ru
    - git clone git@gitlab.beautybox.ru:beautybox/frontend/beautybox-base.git
    - cd beautybox-base
    - yarn
    - yarn link

# build:
#   tags: [build]
#   script:
#     - cp .env.example .env
    # - yarn
    # - yarn build
